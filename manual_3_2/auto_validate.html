{"id":"43","uid":"1","name":"auto_validate","title":"\u81ea\u52a8\u9a8c\u8bc1","category_id":"1","description":"","pid":"10","model_id":"2","root":"1","type":"1","position":"0","link_id":"0","cover_id":"0","display":"0","dateline":"0","attach":"0","view":"0","comment":"0","extend":"0","level":"25","create_time":"1381473360","update_time":"1382279214","status":"1","parse":"0","content":"<p>\u81ea\u52a8\u9a8c\u8bc1\u662fThinkPHP\u6a21\u578b\u5c42\u63d0\u4f9b\u7684\u4e00\u79cd\u6570\u636e\u9a8c\u8bc1\u65b9\u6cd5\uff0c\u53ef\u4ee5\u5728\u4f7f\u7528create\u521b\u5efa\u6570\u636e\u5bf9\u8c61\u7684\u65f6\u5019\u81ea\u52a8\u8fdb\u884c\u6570\u636e\u9a8c\u8bc1\u3002<\/p>\n\n<h2>\u9a8c\u8bc1\u89c4\u5219<\/h2>\n\n<p>\u6570\u636e\u9a8c\u8bc1\u53ef\u4ee5\u8fdb\u884c\u6570\u636e\u7c7b\u578b\u3001\u4e1a\u52a1\u89c4\u5219\u3001\u5b89\u5168\u5224\u65ad\u7b49\u65b9\u9762\u7684\u9a8c\u8bc1\u64cd\u4f5c\u3002<\/p>\n\n<p>\u6570\u636e\u9a8c\u8bc1\u6709\u4e24\u79cd\u65b9\u5f0f\uff1a<\/p>\n\n<ol>\n<li>\u9759\u6001\u65b9\u5f0f\uff1a\u5728\u6a21\u578b\u7c7b\u91cc\u9762\u901a\u8fc7$_validate\u5c5e\u6027\u5b9a\u4e49\u9a8c\u8bc1\u89c4\u5219\u3002<\/li>\n<li>\u52a8\u6001\u65b9\u5f0f\uff1a\u4f7f\u7528\u6a21\u578b\u7c7b\u7684validate\u65b9\u6cd5\u52a8\u6001\u521b\u5efa\u81ea\u52a8\u9a8c\u8bc1\u89c4\u5219\u3002<\/li>\n<\/ol>\n\n<p>\u65e0\u8bba\u662f\u4ec0\u4e48\u65b9\u5f0f\uff0c\u9a8c\u8bc1\u89c4\u5219\u7684\u5b9a\u4e49\u662f\u7edf\u4e00\u7684\u89c4\u5219\uff0c\u5b9a\u4e49\u683c\u5f0f\u4e3a\uff1a<\/p>\n\n<pre><code>array(\n     array(\u9a8c\u8bc1\u5b57\u6bb51,\u9a8c\u8bc1\u89c4\u5219,\u9519\u8bef\u63d0\u793a,[\u9a8c\u8bc1\u6761\u4ef6,\u9644\u52a0\u89c4\u5219,\u9a8c\u8bc1\u65f6\u95f4]),\n     array(\u9a8c\u8bc1\u5b57\u6bb52,\u9a8c\u8bc1\u89c4\u5219,\u9519\u8bef\u63d0\u793a,[\u9a8c\u8bc1\u6761\u4ef6,\u9644\u52a0\u89c4\u5219,\u9a8c\u8bc1\u65f6\u95f4]),\n     ......\n);\n<\/code><\/pre>\n\n<p>\u8bf4\u660e<\/p>\n\n<h5>\u9a8c\u8bc1\u5b57\u6bb5 \uff08\u5fc5\u987b\uff09<\/h5>\n\n<p>\u9700\u8981\u9a8c\u8bc1\u7684\u8868\u5355\u5b57\u6bb5\u540d\u79f0\uff0c\u8fd9\u4e2a\u5b57\u6bb5\u4e0d\u4e00\u5b9a\u662f\u6570\u636e\u5e93\u5b57\u6bb5\uff0c\u4e5f\u53ef\u4ee5\u662f\u8868\u5355\u7684\u4e00\u4e9b\u8f85\u52a9\u5b57\u6bb5\uff0c\u4f8b\u5982\u786e\u8ba4\u5bc6\u7801\u548c\u9a8c\u8bc1\u7801\u7b49\u7b49\u3002\u6709\u4e2a\u522b\u9a8c\u8bc1\u89c4\u5219\u548c\u5b57\u6bb5\u65e0\u5173\u7684\u60c5\u51b5\u4e0b\uff0c\u9a8c\u8bc1\u5b57\u6bb5\u662f\u53ef\u4ee5\u968f\u610f\u8bbe\u7f6e\u7684\uff0c\u4f8b\u5982expire\u6709\u6548\u671f\u89c4\u5219\u662f\u548c\u8868\u5355\u5b57\u6bb5\u65e0\u5173\u7684\u3002\u5982\u679c\u5b9a\u4e49\u4e86\u5b57\u6bb5\u6620\u5c04\u7684\u8bdd\uff0c\u8fd9\u91cc\u7684\u9a8c\u8bc1\u5b57\u6bb5\u540d\u79f0\u5e94\u8be5\u662f\u5b9e\u9645\u7684\u6570\u636e\u8868\u5b57\u6bb5\u800c\u4e0d\u662f\u8868\u5355\u5b57\u6bb5\u3002<\/p>\n\n<h5>\u9a8c\u8bc1\u89c4\u5219 \uff08\u5fc5\u987b\uff09<\/h5>\n\n<p>\u8981\u8fdb\u884c\u9a8c\u8bc1\u7684\u89c4\u5219\uff0c\u9700\u8981\u7ed3\u5408\u9644\u52a0\u89c4\u5219\uff0c\u5982\u679c\u5728\u4f7f\u7528\u6b63\u5219\u9a8c\u8bc1\u7684\u9644\u52a0\u89c4\u5219\u60c5\u51b5\u4e0b\uff0c\u7cfb\u7edf\u8fd8\u5185\u7f6e\u4e86\u4e00\u4e9b\u5e38\u7528\u6b63\u5219\u9a8c\u8bc1\u7684\u89c4\u5219\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f5c\u4e3a\u9a8c\u8bc1\u89c4\u5219\u4f7f\u7528\uff0c\u5305\u62ec\uff1arequire \u5b57\u6bb5\u5fc5\u987b\u3001email \u90ae\u7bb1\u3001url URL\u5730\u5740\u3001currency \u8d27\u5e01\u3001number \u6570\u5b57\u3002<\/p>\n\n<h5>\u63d0\u793a\u4fe1\u606f \uff08\u5fc5\u987b\uff09<\/h5>\n\n<p>\u7528\u4e8e\u9a8c\u8bc1\u5931\u8d25\u540e\u7684\u63d0\u793a\u4fe1\u606f\u5b9a\u4e49<\/p>\n\n<h5>\u9a8c\u8bc1\u6761\u4ef6 \uff08\u53ef\u9009\uff09<\/h5>\n\n<p>\u5305\u542b\u4e0b\u9762\u51e0\u79cd\u60c5\u51b5\uff1a<\/p>\n\n<ul>\n<li>self::EXISTS_VALIDATE \u6216\u80050 \u5b58\u5728\u5b57\u6bb5\u5c31\u9a8c\u8bc1\uff08\u9ed8\u8ba4\uff09  <\/li>\n<li>self::MUST_VALIDATE \u6216\u80051 \u5fc5\u987b\u9a8c\u8bc1  <\/li>\n<li>self::VALUE_VALIDATE\u6216\u80052 \u503c\u4e0d\u4e3a\u7a7a\u7684\u65f6\u5019\u9a8c\u8bc1  <\/li>\n<\/ul>\n\n<h5>\u9644\u52a0\u89c4\u5219 \uff08\u53ef\u9009\uff09<\/h5>\n\n<p>\u914d\u5408\u9a8c\u8bc1\u89c4\u5219\u4f7f\u7528\uff0c\u5305\u62ec\u4e0b\u9762\u4e00\u4e9b\u89c4\u5219\uff1a\n<table>\n<thead>\n<tr>\n  <th>\u89c4\u5219<\/th>\n  <th>\u8bf4\u660e<\/th>\n<\/tr>\n<\/thead>\n<tbody>\n<tr>\n  <td>regex<\/td>\n  <td>\u6b63\u5219\u9a8c\u8bc1\uff0c\u5b9a\u4e49\u7684\u9a8c\u8bc1\u89c4\u5219\u662f\u4e00\u4e2a\u6b63\u5219\u8868\u8fbe\u5f0f\uff08\u9ed8\u8ba4\uff09<\/td>\n<\/tr>\n<tr>\n  <td>function<\/td>\n  <td>\u51fd\u6570\u9a8c\u8bc1\uff0c\u5b9a\u4e49\u7684\u9a8c\u8bc1\u89c4\u5219\u662f\u4e00\u4e2a\u51fd\u6570\u540d<\/td>\n<\/tr>\n<tr>\n  <td>callback<\/td>\n  <td>\u65b9\u6cd5\u9a8c\u8bc1\uff0c\u5b9a\u4e49\u7684\u9a8c\u8bc1\u89c4\u5219\u662f\u5f53\u524d\u6a21\u578b\u7c7b\u7684\u4e00\u4e2a\u65b9\u6cd5<\/td>\n<\/tr>\n<tr>\n  <td>confirm<\/td>\n  <td>\u9a8c\u8bc1\u8868\u5355\u4e2d\u7684\u4e24\u4e2a\u5b57\u6bb5\u662f\u5426\u76f8\u540c\uff0c\u5b9a\u4e49\u7684\u9a8c\u8bc1\u89c4\u5219\u662f\u4e00\u4e2a\u5b57\u6bb5\u540d<\/td>\n<\/tr>\n<tr>\n  <td>equal<\/td>\n  <td>\u9a8c\u8bc1\u662f\u5426\u7b49\u4e8e\u67d0\u4e2a\u503c\uff0c\u8be5\u503c\u7531\u524d\u9762\u7684\u9a8c\u8bc1\u89c4\u5219\u5b9a\u4e49<\/td>\n<\/tr>\n<tr>\n  <td>notequal<\/td>\n  <td>\u9a8c\u8bc1\u662f\u5426\u4e0d\u7b49\u4e8e\u67d0\u4e2a\u503c\uff0c\u8be5\u503c\u7531\u524d\u9762\u7684\u9a8c\u8bc1\u89c4\u5219\u5b9a\u4e49\uff083.1.2\u7248\u672c\u65b0\u589e\uff09<\/td>\n<\/tr>\n<tr>\n  <td>in<\/td>\n  <td>\u9a8c\u8bc1\u662f\u5426\u5728\u67d0\u4e2a\u8303\u56f4\u5185\uff0c\u5b9a\u4e49\u7684\u9a8c\u8bc1\u89c4\u5219\u53ef\u4ee5\u662f\u4e00\u4e2a\u6570\u7ec4\u6216\u8005\u9017\u53f7\u5206\u5272\u7684\u5b57\u7b26\u4e32<\/td>\n<\/tr>\n<tr>\n  <td>notin<\/td>\n  <td>\u9a8c\u8bc1\u662f\u5426\u4e0d\u5728\u67d0\u4e2a\u8303\u56f4\u5185\uff0c\u5b9a\u4e49\u7684\u9a8c\u8bc1\u89c4\u5219\u53ef\u4ee5\u662f\u4e00\u4e2a\u6570\u7ec4\u6216\u8005\u9017\u53f7\u5206\u5272\u7684\u5b57\u7b26\u4e32\uff083.1.2\u7248\u672c\u65b0\u589e\uff09<\/td>\n<\/tr>\n<tr>\n  <td>length<\/td>\n  <td>\u9a8c\u8bc1\u957f\u5ea6\uff0c\u5b9a\u4e49\u7684\u9a8c\u8bc1\u89c4\u5219\u53ef\u4ee5\u662f\u4e00\u4e2a\u6570\u5b57\uff08\u8868\u793a\u56fa\u5b9a\u957f\u5ea6\uff09\u6216\u8005\u6570\u5b57\u8303\u56f4\uff08\u4f8b\u59823,12 \u8868\u793a\u957f\u5ea6\u4ece3\u523012\u7684\u8303\u56f4\uff09<\/td>\n<\/tr>\n<tr>\n  <td>between<\/td>\n  <td>\u9a8c\u8bc1\u8303\u56f4\uff0c\u5b9a\u4e49\u7684\u9a8c\u8bc1\u89c4\u5219\u8868\u793a\u8303\u56f4\uff0c\u53ef\u4ee5\u4f7f\u7528\u5b57\u7b26\u4e32\u6216\u8005\u6570\u7ec4\uff0c\u4f8b\u59821,31\u6216\u8005array(1,31)<\/td>\n<\/tr>\n<tr>\n  <td>notbetween<\/td>\n  <td>\u9a8c\u8bc1\u4e0d\u5728\u67d0\u4e2a\u8303\u56f4\uff0c\u5b9a\u4e49\u7684\u9a8c\u8bc1\u89c4\u5219\u8868\u793a\u8303\u56f4\uff0c\u53ef\u4ee5\u4f7f\u7528\u5b57\u7b26\u4e32\u6216\u8005\u6570\u7ec4\uff083.1.2\u7248\u672c\u65b0\u589e\uff09<\/td>\n<\/tr>\n<tr>\n  <td>expire<\/td>\n  <td>\u9a8c\u8bc1\u662f\u5426\u5728\u6709\u6548\u671f\uff0c\u5b9a\u4e49\u7684\u9a8c\u8bc1\u89c4\u5219\u8868\u793a\u65f6\u95f4\u8303\u56f4\uff0c\u53ef\u4ee5\u5230\u65f6\u95f4\uff0c\u4f8b\u5982\u53ef\u4ee5\u4f7f\u7528 2012-1-15,2013-1-15 \u8868\u793a\u5f53\u524d\u63d0\u4ea4\u6709\u6548\u671f\u57282012-1-15\u52302013-1-15\u4e4b\u95f4\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u65f6\u95f4\u6233\u5b9a\u4e49<\/td>\n<\/tr>\n<tr>\n  <td>ip_allow<\/td>\n  <td>\u9a8c\u8bc1IP\u662f\u5426\u5141\u8bb8\uff0c\u5b9a\u4e49\u7684\u9a8c\u8bc1\u89c4\u5219\u8868\u793a\u5141\u8bb8\u7684IP\u5730\u5740\u5217\u8868\uff0c\u7528\u9017\u53f7\u5206\u9694\uff0c\u4f8b\u5982201.12.2.5,201.12.2.6<\/td>\n<\/tr>\n<tr>\n  <td>ip_deny<\/td>\n  <td>\u9a8c\u8bc1IP\u662f\u5426\u7981\u6b62\uff0c\u5b9a\u4e49\u7684\u9a8c\u8bc1\u89c4\u5219\u8868\u793a\u7981\u6b62\u7684ip\u5730\u5740\u5217\u8868\uff0c\u7528\u9017\u53f7\u5206\u9694\uff0c\u4f8b\u5982201.12.2.5,201.12.2.6<\/td>\n<\/tr>\n<tr>\n  <td>unique<\/td>\n  <td>\u9a8c\u8bc1\u662f\u5426\u552f\u4e00\uff0c\u7cfb\u7edf\u4f1a\u6839\u636e\u5b57\u6bb5\u76ee\u524d\u7684\u503c\u67e5\u8be2\u6570\u636e\u5e93\u6765\u5224\u65ad\u662f\u5426\u5b58\u5728\u76f8\u540c\u7684\u503c\uff0c\u5f53\u8868\u5355\u6570\u636e\u4e2d\u5305\u542b\u4e3b\u952e\u5b57\u6bb5\u65f6unique\u4e0d\u53ef\u7528\u4e8e\u5224\u65ad\u4e3b\u952e\u5b57\u6bb5\u672c\u8eab<\/td>\n<\/tr>\n<\/tbody>\n<\/table><\/p>\n\n<h5>\u9a8c\u8bc1\u65f6\u95f4\uff08\u53ef\u9009\uff09<\/h5>\n\n<ul>\n<li>self::MODEL_INSERT\u6216\u80051\u65b0\u589e\u6570\u636e\u65f6\u5019\u9a8c\u8bc1  <\/li>\n<li>self::MODEL_UPDATE\u6216\u80052\u7f16\u8f91\u6570\u636e\u65f6\u5019\u9a8c\u8bc1  <\/li>\n<li>self::MODEL_BOTH\u6216\u80053\u5168\u90e8\u60c5\u51b5\u4e0b\u9a8c\u8bc1\uff08\u9ed8\u8ba4\uff09  <\/li>\n<\/ul>\n\n<p>\u8fd9\u91cc\u7684\u9a8c\u8bc1\u65f6\u95f4\u9700\u8981\u6ce8\u610f\uff0c\u5e76\u975e\u53ea\u6709\u8fd9\u4e09\u79cd\u60c5\u51b5\uff0c\u4f60\u53ef\u4ee5\u6839\u636e\u4e1a\u52a1\u9700\u8981\u589e\u52a0\u5176\u4ed6\u7684\u9a8c\u8bc1\u65f6\u95f4\u3002<\/p>\n\n<h2>\u9759\u6001\u5b9a\u4e49<\/h2>\n\n<p>\u5728\u6a21\u578b\u7c7b\u91cc\u9762\u9884\u5148\u5b9a\u4e49\u597d\u8be5\u6a21\u578b\u7684\u81ea\u52a8\u9a8c\u8bc1\u89c4\u5219\uff0c\u6211\u4eec\u79f0\u4e3a\u9759\u6001\u5b9a\u4e49\u3002<\/p>\n\n<p>\u4e3e\u4f8b\u8bf4\u660e\uff0c\u6211\u4eec\u5728\u6a21\u578b\u7c7b\u91cc\u9762\u5b9a\u4e49\u4e86<code>$_validate<\/code>\u5c5e\u6027\u5982\u4e0b\uff1a<\/p>\n\n<pre><code>namespace Home\\Model;\nuse Think\\Model;\nclass UserModel extends Model{\n   protected $_validate = array(\n     array('verify','require','\u9a8c\u8bc1\u7801\u5fc5\u987b\uff01'), \/\/\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u7528\u6b63\u5219\u8fdb\u884c\u9a8c\u8bc1\n     array('name','','\u5e10\u53f7\u540d\u79f0\u5df2\u7ecf\u5b58\u5728\uff01',0,'unique',1), \/\/ \u5728\u65b0\u589e\u7684\u65f6\u5019\u9a8c\u8bc1name\u5b57\u6bb5\u662f\u5426\u552f\u4e00\n     array('value',array(1,2,3),'\u503c\u7684\u8303\u56f4\u4e0d\u6b63\u786e\uff01',2,'in'), \/\/ \u5f53\u503c\u4e0d\u4e3a\u7a7a\u7684\u65f6\u5019\u5224\u65ad\u662f\u5426\u5728\u4e00\u4e2a\u8303\u56f4\u5185\n     array('repassword','password','\u786e\u8ba4\u5bc6\u7801\u4e0d\u6b63\u786e',0,'confirm'), \/\/ \u9a8c\u8bc1\u786e\u8ba4\u5bc6\u7801\u662f\u5426\u548c\u5bc6\u7801\u4e00\u81f4\n     array('password','checkPwd','\u5bc6\u7801\u683c\u5f0f\u4e0d\u6b63\u786e',0,'function'), \/\/ \u81ea\u5b9a\u4e49\u51fd\u6570\u9a8c\u8bc1\u5bc6\u7801\u683c\u5f0f\n   );\n}\n<\/code><\/pre>\n\n<p>\u5b9a\u4e49\u597d\u9a8c\u8bc1\u89c4\u5219\u540e\uff0c\u5c31\u53ef\u4ee5\u5728\u4f7f\u7528create\u65b9\u6cd5\u521b\u5efa\u6570\u636e\u5bf9\u8c61\u7684\u65f6\u5019\u81ea\u52a8\u8c03\u7528\uff1a<\/p>\n\n<pre><code>$User = D(\"User\"); \/\/ \u5b9e\u4f8b\u5316User\u5bf9\u8c61\nif (!$User-&gt;create()){\n     \/\/ \u5982\u679c\u521b\u5efa\u5931\u8d25 \u8868\u793a\u9a8c\u8bc1\u6ca1\u6709\u901a\u8fc7 \u8f93\u51fa\u9519\u8bef\u63d0\u793a\u4fe1\u606f\n     exit($User-&gt;getError());\n}else{\n     \/\/ \u9a8c\u8bc1\u901a\u8fc7 \u53ef\u4ee5\u8fdb\u884c\u5176\u4ed6\u6570\u636e\u64cd\u4f5c\n}\n<\/code><\/pre>\n\n<p>\u5728\u8fdb\u884c\u81ea\u52a8\u9a8c\u8bc1\u7684\u65f6\u5019\uff0c\u7cfb\u7edf\u4f1a\u5bf9\u5b9a\u4e49\u597d\u7684\u9a8c\u8bc1\u89c4\u5219\u8fdb\u884c\u4f9d\u6b21\u9a8c\u8bc1\u3002\u5982\u679c\u67d0\u4e00\u6761\u9a8c\u8bc1\u89c4\u5219\u6ca1\u6709\u901a\u8fc7\uff0c\u5219\u4f1a\u62a5\u9519\uff0cgetError\u65b9\u6cd5\u8fd4\u56de\u7684\u9519\u8bef\u4fe1\u606f\uff08\u5b57\u7b26\u4e32\uff09\u5c31\u662f\u5bf9\u5e94\u5b57\u6bb5\u7684\u9a8c\u8bc1\u89c4\u5219\u91cc\u9762\u7684\u9519\u8bef\u63d0\u793a\u4fe1\u606f\u3002<\/p>\n\n<blockquote>\n  <p>\u9759\u6001\u5b9a\u4e49\u65b9\u5f0f\u56e0\u4e3a\u5fc5\u987b\u5b9a\u4e49\u6a21\u578b\u7c7b\uff0c\u6240\u4ee5\u53ea\u80fd\u7528D\u51fd\u6570\u5b9e\u4f8b\u5316\u6a21\u578b<\/p>\n<\/blockquote>\n\n<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0ccreate\u65b9\u6cd5\u662f\u5bf9\u8868\u5355\u63d0\u4ea4\u7684POST\u6570\u636e\u8fdb\u884c\u81ea\u52a8\u9a8c\u8bc1\uff0c\u5982\u679c\u4f60\u7684\u6570\u636e\u6765\u6e90\u4e0d\u662f\u8868\u5355post\uff0c\u4ecd\u7136\u4e5f\u53ef\u4ee5\u8fdb\u884c\u81ea\u52a8\u9a8c\u8bc1\uff0c\u65b9\u6cd5\u6539\u8fdb\u5982\u4e0b\uff1a<\/p>\n\n<pre><code>$User = D(\"User\"); \/\/ \u5b9e\u4f8b\u5316User\u5bf9\u8c61\n$data = getData(); \/\/ \u901a\u8fc7getData\u65b9\u6cd5\u83b7\u53d6\u6570\u636e\u6e90\u7684\uff08\u6570\u7ec4\uff09\u6570\u636e\nif (!$User-&gt;create($data)){\n     \/\/ \u5bf9data\u6570\u636e\u8fdb\u884c\u9a8c\u8bc1\n     exit($User-&gt;getError());\n}else{\n     \/\/ \u9a8c\u8bc1\u901a\u8fc7 \u53ef\u4ee5\u8fdb\u884c\u5176\u4ed6\u6570\u636e\u64cd\u4f5c\n}\n<\/code><\/pre>\n\n<p>\u4e00\u822c\u60c5\u51b5\u4e0b\uff0ccreate\u65b9\u6cd5\u4f1a\u81ea\u52a8\u5224\u65ad\u5f53\u524d\u662f\u65b0\u589e\u6570\u636e\u8fd8\u662f\u7f16\u8f91\u6570\u636e\uff08\u4e3b\u8981\u662f\u901a\u8fc7\u8868\u5355\u7684\u9690\u85cf\u6570\u636e\u6dfb\u52a0\u4e3b\u952e\u4fe1\u606f\uff09\uff0c\u4f60\u4e5f\u53ef\u4ee5\u660e\u786e\u6307\u5b9a\u5f53\u524d\u521b\u5efa\u7684\u6570\u636e\u5bf9\u8c61\u662f\u65b0\u589e\u8fd8\u662f\u7f16\u8f91\uff0c\u4f8b\u5982\uff1a<\/p>\n\n<pre><code>$User = D(\"User\"); \/\/ \u5b9e\u4f8b\u5316User\u5bf9\u8c61\nif (!$User-&gt;create($_POST,1)){ \/\/ \u6307\u5b9a\u65b0\u589e\u6570\u636e\n     \/\/ \u5982\u679c\u521b\u5efa\u5931\u8d25 \u8868\u793a\u9a8c\u8bc1\u6ca1\u6709\u901a\u8fc7 \u8f93\u51fa\u9519\u8bef\u63d0\u793a\u4fe1\u606f\n     exit($User-&gt;getError());\n}else{\n     \/\/ \u9a8c\u8bc1\u901a\u8fc7 \u53ef\u4ee5\u8fdb\u884c\u5176\u4ed6\u6570\u636e\u64cd\u4f5c\n}\n<\/code><\/pre>\n\n<p>create\u65b9\u6cd5\u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570\u5c31\u7528\u4e8e\u6307\u5b9a\u81ea\u52a8\u9a8c\u8bc1\u89c4\u5219\u4e2d\u7684\u9a8c\u8bc1\u65f6\u95f4\uff0c\u4e5f\u5c31\u662f\u8bf4create\u65b9\u6cd5\u7684\u81ea\u52a8\u9a8c\u8bc1\u53ea\u4f1a\u9a8c\u8bc1\u7b26\u5408\u9a8c\u8bc1\u65f6\u95f4\u7684\u9a8c\u8bc1\u89c4\u5219\u3002<\/p>\n\n<p>\u6211\u4eec\u5728\u4e0a\u9762\u63d0\u5230\u8fd9\u91cc\u7684\u9a8c\u8bc1\u65f6\u95f4\u5e76\u975e\u53ea\u6709\u8fd9\u51e0\u79cd\u60c5\u51b5\uff0c\u4f60\u53ef\u4ee5\u6839\u636e\u4e1a\u52a1\u9700\u8981\u589e\u52a0\u5176\u4ed6\u7684\u9a8c\u8bc1\u65f6\u95f4\uff0c\u4f8b\u5982\uff0c\u4f60\u53ef\u4ee5\u7ed9\u767b\u5f55\u64cd\u4f5c\u4e13\u95e8\u6307\u5b9a\u9a8c\u8bc1\u65f6\u95f4\u4e3a4\u3002\u6211\u4eec\u5b9a\u4e49\u9a8c\u8bc1\u89c4\u5219\u5982\u4e0b\uff1a<\/p>\n\n<pre><code>namespace Home\\Model;\nuse Think\\Model;\nclass UserModel extends Model{\n   protected $_validate = array(\n     array('verify','require','\u9a8c\u8bc1\u7801\u5fc5\u987b\uff01'),  \/\/ \u90fd\u6709\u65f6\u95f4\u90fd\u9a8c\u8bc1\n     array('name','checkName','\u5e10\u53f7\u9519\u8bef\uff01',1,'function',4),  \/\/ \u53ea\u5728\u767b\u5f55\u65f6\u5019\u9a8c\u8bc1\n     array('password','checkPwd','\u5bc6\u7801\u9519\u8bef\uff01',1,'function',4), \/\/ \u53ea\u5728\u767b\u5f55\u65f6\u5019\u9a8c\u8bc1\n   );\n}\n<\/code><\/pre>\n\n<p>\u90a3\u4e48\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5728\u767b\u5f55\u7684\u65f6\u5019\u4f7f\u7528<\/p>\n\n<pre><code>$User = D(\"User\"); \/\/ \u5b9e\u4f8b\u5316User\u5bf9\u8c61\nif (!$User-&gt;create($_POST,4)){ \/\/ \u767b\u5f55\u9a8c\u8bc1\u6570\u636e\n     \/\/ \u9a8c\u8bc1\u6ca1\u6709\u901a\u8fc7 \u8f93\u51fa\u9519\u8bef\u63d0\u793a\u4fe1\u606f\n     exit($User-&gt;getError());\n}else{\n     \/\/ \u9a8c\u8bc1\u901a\u8fc7 \u6267\u884c\u767b\u5f55\u64cd\u4f5c\n}\n<\/code><\/pre>\n\n<h2>\u52a8\u6001\u9a8c\u8bc1<\/h2>\n\n<p>\u5982\u679c\u91c7\u7528\u52a8\u6001\u9a8c\u8bc1\u7684\u65b9\u5f0f\uff0c\u5c31\u6bd4\u8f83\u7075\u6d3b\uff0c\u53ef\u4ee5\u6839\u636e\u4e0d\u540c\u7684\u9700\u8981\uff0c\u5728\u64cd\u4f5c\u540c\u4e00\u4e2a\u6a21\u578b\u7684\u65f6\u5019\u4f7f\u7528\u4e0d\u540c\u7684\u9a8c\u8bc1\u89c4\u5219\uff0c\u4f8b\u5982\u4e0a\u9762\u7684\u9759\u6001\u9a8c\u8bc1\u65b9\u5f0f\u53ef\u4ee5\u6539\u4e3a\uff1a<\/p>\n\n<pre><code>$rules = array(\n     array('verify','require','\u9a8c\u8bc1\u7801\u5fc5\u987b\uff01'), \/\/\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u7528\u6b63\u5219\u8fdb\u884c\u9a8c\u8bc1\n     array('name','','\u5e10\u53f7\u540d\u79f0\u5df2\u7ecf\u5b58\u5728\uff01',0,'unique',1), \/\/ \u5728\u65b0\u589e\u7684\u65f6\u5019\u9a8c\u8bc1name\u5b57\u6bb5\u662f\u5426\u552f\u4e00\n     array('value',array(1,2,3),'\u503c\u7684\u8303\u56f4\u4e0d\u6b63\u786e\uff01',2,'in'), \/\/ \u5f53\u503c\u4e0d\u4e3a\u7a7a\u7684\u65f6\u5019\u5224\u65ad\u662f\u5426\u5728\u4e00\u4e2a\u8303\u56f4\u5185\n     array('repassword','password','\u786e\u8ba4\u5bc6\u7801\u4e0d\u6b63\u786e',0,'confirm'), \/\/ \u9a8c\u8bc1\u786e\u8ba4\u5bc6\u7801\u662f\u5426\u548c\u5bc6\u7801\u4e00\u81f4\n     array('password','checkPwd','\u5bc6\u7801\u683c\u5f0f\u4e0d\u6b63\u786e',0,'function'), \/\/ \u81ea\u5b9a\u4e49\u51fd\u6570\u9a8c\u8bc1\u5bc6\u7801\u683c\u5f0f\n);\n\n$User = M(\"User\"); \/\/ \u5b9e\u4f8b\u5316User\u5bf9\u8c61\nif (!$User-&gt;validate($rules)-&gt;create()){\n     \/\/ \u5982\u679c\u521b\u5efa\u5931\u8d25 \u8868\u793a\u9a8c\u8bc1\u6ca1\u6709\u901a\u8fc7 \u8f93\u51fa\u9519\u8bef\u63d0\u793a\u4fe1\u606f\n     exit($User-&gt;getError());\n}else{\n     \/\/ \u9a8c\u8bc1\u901a\u8fc7 \u53ef\u4ee5\u8fdb\u884c\u5176\u4ed6\u6570\u636e\u64cd\u4f5c\n}\n<\/code><\/pre>\n\n<blockquote>\n  <p>\u52a8\u6001\u9a8c\u8bc1\u4e0d\u4f9d\u8d56\u6a21\u578b\u7c7b\u7684\u5b9a\u4e49\uff0c\u6240\u4ee5\u901a\u5e38\u7528M\u51fd\u6570\u5b9e\u4f8b\u5316\u6a21\u578b\u5c31\u53ef\u4ee5<\/p>\n<\/blockquote>\n\n<h2>\u9519\u8bef\u4fe1\u606f\u591a\u8bed\u8a00\u652f\u6301<\/h2>\n\n<p>\u5982\u679c\u4f60\u5e0c\u671b\u652f\u6301\u591a\u8bed\u8a00\u7684\u9519\u8bef\u4fe1\u606f\u63d0\u793a\uff0c\u90a3\u4e48\u53ef\u4ee5\u5728\u9a8c\u8bc1\u89c4\u5219\u91cc\u9762\u5982\u4e0b\u5b9a\u4e49\uff1a<\/p>\n\n<pre><code>protected $_validate = array(\n     array('verify','require','{%VERIFY_CODE_MUST}'), \n     array('name','','{%ACCOUNT_EXISTS}',0,'unique',1), \n);\n<\/code><\/pre>\n\n<p>\u5176\u4e2d<code>VERIFY_CODE_MUST<\/code>\u548c<code>ACCOUNT_EXISTS<\/code>\u662f\u6211\u4eec\u5728\u8bed\u8a00\u5305\u91cc\u9762\u5b9a\u4e49\u7684\u591a\u8bed\u8a00\u53d8\u91cf\u3002<\/p>\n\n<p>\u5982\u679c\u662f\u91c7\u7528\u52a8\u6001\u9a8c\u8bc1\u65b9\u5f0f\uff0c\u5219\u6bd4\u8f83\u7b80\u5355\uff0c\u76f4\u63a5\u5728\u5b9a\u4e49\u9a8c\u8bc1\u89c4\u5219\u7684\u65f6\u5019\u4f7f\u7528L\u65b9\u6cd5\u5373\u53ef\uff0c\u4f8b\u5982\uff1a<\/p>\n\n<pre><code>$rules = array(\n     array('verify','require',L('VERIFY_CODE_MUST')), \n     array('name','',L('ACCOUNT_EXISTS'),0,'unique',1), \n);\n<\/code><\/pre>\n\n<h2>\u6279\u91cf\u9a8c\u8bc1<\/h2>\n\n<p>\u7cfb\u7edf\u652f\u6301\u6570\u636e\u7684\u6279\u91cf\u9a8c\u8bc1\u529f\u80fd\uff0c\u53ea\u9700\u8981\u5728\u6a21\u578b\u7c7b\u91cc\u9762\u8bbe\u7f6epatchValidate\u5c5e\u6027\u4e3atrue\uff08 \u9ed8\u8ba4\u4e3afalse\uff09\uff0c<\/p>\n\n<pre><code>protected $patchValidate = true;\n<\/code><\/pre>\n\n<p>\u8bbe\u7f6e\u6279\u5904\u7406\u9a8c\u8bc1\u540e\uff0c<code>getError()<\/code> \u65b9\u6cd5\u8fd4\u56de\u7684\u9519\u8bef\u4fe1\u606f\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u8fd4\u56de\u683c\u5f0f\u662f\uff1a<\/p>\n\n<pre><code>array(\"\u5b57\u6bb5\u540d1\"=&gt;\"\u9519\u8bef\u63d0\u793a1\",\"\u5b57\u6bb5\u540d2\"=&gt;\"\u9519\u8bef\u63d0\u793a2\"... )\n<\/code><\/pre>\n\n<p>\u524d\u7aef\u53ef\u4ee5\u6839\u636e\u9700\u8981\u9700\u8981\u81ea\u884c\u5904\u7406\uff0c\u4f8b\u5982\u8f6c\u6362\u6210json\u683c\u5f0f\u8fd4\u56de\uff1a<\/p>\n\n<pre><code>$User = D(\"User\"); \/\/ \u5b9e\u4f8b\u5316User\u5bf9\u8c61\nif (!$User-&gt;create()){\n     \/\/ \u5982\u679c\u521b\u5efa\u5931\u8d25 \u8868\u793a\u9a8c\u8bc1\u6ca1\u6709\u901a\u8fc7 \u8f93\u51fa\u9519\u8bef\u63d0\u793a\u4fe1\u606f\n     $this-&gt;ajaxReturn($User-&gt;getError());\n}else{\n     \/\/ \u9a8c\u8bc1\u901a\u8fc7 \u53ef\u4ee5\u8fdb\u884c\u5176\u4ed6\u6570\u636e\u64cd\u4f5c\n}\n<\/code><\/pre>\n","template":""}